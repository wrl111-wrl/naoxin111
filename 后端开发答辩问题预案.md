# å­¦ç”Ÿç®¡ç†ç³»ç»Ÿåç«¯å¼€å‘ç­”è¾©é—®é¢˜é¢„æ¡ˆ

## ä¸€ã€Spring Bootæ¡†æ¶ç›¸å…³é—®é¢˜

### Q1: è¯·ä»‹ç»ä¸€ä¸‹ä½ ä¸ºä»€ä¹ˆé€‰æ‹©Spring Bootä½œä¸ºåç«¯æ¡†æ¶ï¼Ÿå®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**
é€‰æ‹©Spring Bootä½œä¸ºåç«¯æ¡†æ¶ä¸»è¦åŸºäºä»¥ä¸‹è€ƒè™‘ï¼š

1. **å¿«é€Ÿå¼€å‘èƒ½åŠ›**
   ```java
   // Spring Bootçš„è‡ªåŠ¨é…ç½®ç‰¹æ€§
   @SpringBootApplication
   @EnableAutoConfiguration
   public class StudentManagementApplication {
       public static void main(String[] args) {
           SpringApplication.run(StudentManagementApplication.class, args);
       }
   }
   
   // å¼€ç®±å³ç”¨çš„é…ç½®
   spring.datasource.url=jdbc:mysql://localhost:3306/student_management
   spring.datasource.username=root
   spring.datasource.password=password
   ```

2. **é¡¹ç›®ç‰¹ç‚¹åŒ¹é…**
   - **å¾®æœåŠ¡æ¶æ„**ï¼šSpring Bootå¤©ç„¶æ”¯æŒå¾®æœåŠ¡æ‹†åˆ†
   - **RESTful API**ï¼šå†…ç½®å¯¹RESTé£æ ¼çš„æ”¯æŒ
   - **æ•°æ®è®¿é—®**ï¼šä¸MyBatis-Plusæ— ç¼é›†æˆ
   - **å®‰å…¨æ¡†æ¶**ï¼šSpring Securityé›†æˆç®€å•

3. **æŠ€æœ¯ä¼˜åŠ¿**
   - **çº¦å®šä¼˜äºé…ç½®**ï¼šå‡å°‘å¤§é‡XMLé…ç½®
   - **å†…åµŒæœåŠ¡å™¨**ï¼šæ— éœ€ç‹¬ç«‹éƒ¨ç½²Tomcat
   - **ç”Ÿäº§å°±ç»ª**ï¼šActuatorç›‘æ§ã€å¥åº·æ£€æŸ¥
   - **ç”Ÿæ€ä¸°å¯Œ**ï¼šå¤§é‡starterä¾èµ–ï¼Œé›†æˆæ–¹ä¾¿

4. **å›¢é˜Ÿåä½œä¼˜åŠ¿**
   - **æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€çš„å¼€å‘æ¨¡å¼å’Œé¡¹ç›®ç»“æ„
   - **å­¦ä¹ æˆæœ¬**ï¼šå›¢é˜Ÿæˆå‘˜æ˜“äºä¸Šæ‰‹
   - **æ–‡æ¡£å®Œå–„**ï¼šSpringå®˜æ–¹æ–‡æ¡£å’Œç¤¾åŒºæ”¯æŒ

### Q2: ä½ å¦‚ä½•ç†è§£Spring Bootçš„è‡ªåŠ¨é…ç½®åŸç†ï¼Ÿé¡¹ç›®ä¸­å¦‚ä½•åº”ç”¨çš„ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **è‡ªåŠ¨é…ç½®åŸç†**
   ```java
   // æ ¸å¿ƒæ³¨è§£åˆ†æ
   @SpringBootApplication = @Configuration + @EnableAutoConfiguration + @ComponentScan
   
   @EnableAutoConfigurationå¯ç”¨è‡ªåŠ¨é…ç½®
   â”œâ”€â”€ @Import(AutoConfigurationImportSelector.class)
   â”œâ”€â”€ æ‰«æMETA-INF/spring.factories
   â””â”€â”€ åŠ è½½æ¡ä»¶åŒ–é…ç½®ç±»
   ```

2. **é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨**
   ```java
   // MyBatis-Plusè‡ªåŠ¨é…ç½®
   @Configuration
   @ConditionalOnClass({SqlSessionFactory.class, MybatisPlusProperties.class})
   public class MybatisPlusAutoConfiguration {
       
       @Bean
       @ConditionalOnMissingBean
       public MybatisPlusProperties mybatisPlusProperties() {
           MybatisPlusProperties properties = new MybatisPlusProperties();
           properties.setMapperLocations(resources);
           return properties;
       }
   }
   
   // æ•°æ®æºè‡ªåŠ¨é…ç½®
   @Bean
   @Primary
   @ConfigurationProperties("spring.datasource.hikari")
   public DataSource dataSource() {
       return DataSourceBuilder.create().type(HikariDataSource.class).build();
   }
   ```

3. **æ¡ä»¶åŒ–é…ç½®çš„åº”ç”¨**
   ```java
   // è‡ªå®šä¹‰è‡ªåŠ¨é…ç½®
   @Configuration
   @ConditionalOnProperty(name = "student.security.enabled", havingValue = "true")
   @ConditionalOnClass(StudentSecurityService.class)
   public class StudentSecurityAutoConfiguration {
       
       @Bean
       @ConditionalOnMissingBean
       public StudentSecurityService studentSecurityService() {
           return new StudentSecurityServiceImpl();
       }
   }
   ```

## äºŒã€MyBatis-Plusç›¸å…³é—®é¢˜

### Q3: ä½ å¦‚ä½•ä½¿ç”¨MyBatis-Plusè¿›è¡Œæ•°æ®åº“æ“ä½œï¼Ÿæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **MyBatis-Plusæ ¸å¿ƒåŠŸèƒ½**
   ```java
   // 1. åŸºç¡€CRUDæ“ä½œ
   @Mapper
   public interface XueshengxinxiMapper extends BaseMapper<Xueshengxinxi> {
       
       // è‡ªå®šä¹‰SQLæŸ¥è¯¢
       @Select("SELECT * FROM xueshengxinxi WHERE banji = #{banji} AND xingbie = #{xingbie}")
       List<Xueshengxinxi> selectByBanjiAndXingbie(@Param("banji") String banji, @Param("xingbie") String xingbie);
       
       // åˆ†é¡µæŸ¥è¯¢
       @Select("SELECT * FROM xueshengxinxi WHERE xingming LIKE CONCAT('%', #{keyword}, '%')")
       Page<Xueshengxinxi> searchStudents(@Param("keyword") String keyword, Page<Xueshengxinxi> page);
   }
   ```

2. **é¡¹ç›®ä¸­çš„å®é™…åº”ç”¨**
   ```java
   @Service
   public class XueshengxinxiServiceImpl implements XueshengxinxiService {
       
       @Autowired
       private XueshengxinxiMapper xueshengxinxiMapper;
       
       @Override
       public Page<Xueshengxinxi> getList(Integer current, Integer size, String search) {
           Page<Xueshengxinxi> page = new Page<>(current, size);
           QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
           
           if (StringUtils.hasText(search)) {
               wrapper.like("xingming", search)
                     .or().like("banji", search)
                     .or().like("jiguan", search);
           }
           
           wrapper.orderByDesc("id");
           return xueshengxinxiMapper.selectPage(page, wrapper);
       }
       
       @Override
       public Xueshengxinxi add(Xueshengxinxi student) {
           // é»˜è®¤å¯†ç åŠ å¯†
           if (student.getMima() == null) {
               student.setMima("e10adc3949ba59abbe56e057f20f883e");
           } else {
               student.setMima(SecureUtil.md5(student.getMima()));
           }
           
           xueshengxinxiMapper.insert(student);
           return student;
       }
   }
   ```

3. **MyBatis-Plusä¼˜åŠ¿**
   - **ä»£ç ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»ã€Mapperã€Service
   - **æ¡ä»¶æ„é€ å™¨**ï¼šå¼ºå¤§çš„QueryWrapperå’ŒUpdateWrapper
   - **åˆ†é¡µæ’ä»¶**ï¼šå†…ç½®åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½
   - **ä¹è§‚é”**ï¼šç‰ˆæœ¬å·æ§åˆ¶å¹¶å‘æ›´æ–°
   - **é€»è¾‘åˆ é™¤**ï¼šè½¯åˆ é™¤ä¿æŠ¤æ•°æ®å®Œæ•´æ€§

4. **æ€§èƒ½ä¼˜åŒ–å®è·µ**
   ```java
   // æ‰¹é‡æ’å…¥ä¼˜åŒ–
   @Override
   public void batchInsertStudents(List<Xueshengxinxi> students) {
       // ä½¿ç”¨MyBatis-Plusçš„æ‰¹é‡æ’å…¥
       studentMapper.insertBatchSomeColumn(students);
   }
   
   // æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
   @Override
   public List<Xueshengxinxi> getTopStudents(Integer limit) {
       QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
       wrapper.orderByDesc("create_time").last("limit " + limit);
       return xueshengxinxiMapper.selectList(wrapper);
   }
   ```

## ä¸‰ã€RESTful APIè®¾è®¡ç›¸å…³é—®é¢˜

### Q4: ä½ å¦‚ä½•è®¾è®¡RESTful APIï¼Ÿæœ‰å“ªäº›æœ€ä½³å®è·µï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **RESTful APIè®¾è®¡åŸåˆ™**
   ```java
   @RestController
   @RequestMapping("/api/v1/students")
   public class StudentController {
       
       // GET - è·å–å­¦ç”Ÿåˆ—è¡¨ï¼ˆåˆ†é¡µæŸ¥è¯¢ï¼‰
       @GetMapping
       public Result<Page<Xueshengxinxi>> getStudents(
           @RequestParam(defaultValue = "1") Integer current,
           @RequestParam(defaultValue = "10") Integer size,
           @RequestParam(required = false) String search,
           @RequestParam(required = false) String banji) {
           
           Page<Xueshengxinxi> page = xueshengxinxiService.getList(current, size, search, banji);
           return Result.success(page);
       }
       
       // GET - è·å–å•ä¸ªå­¦ç”Ÿè¯¦æƒ…
       @GetMapping("/{id}")
       public Result<Xueshengxinxi> getStudent(@PathVariable Long id) {
           Xueshengxinxi student = xueshengxinxiService.getById(id);
           return Result.success(student);
       }
       
       // POST - åˆ›å»ºå­¦ç”Ÿ
       @PostMapping
       @PreAuthorize("hasRole('guanliyuan')")
       public Result<Xueshengxinxi> createStudent(@RequestBody @Valid Xueshengxinxi student) {
           Xueshengxinxi created = xueshengxinxiService.add(student);
           return Result.success(created);
       }
       
       // PUT - æ›´æ–°å­¦ç”Ÿä¿¡æ¯
       @PutMapping("/{id}")
       @PreAuthorize("hasRole('guanliyuan')")
       public Result<Xueshengxinxi> updateStudent(@PathVariable Long id, @RequestBody Xueshengxinxi student) {
           student.setId(id);
           Xueshengxinxi updated = xueshengxinxiService.updateById(student);
           return Result.success(updated);
       }
       
       // DELETE - åˆ é™¤å­¦ç”Ÿ
       @DeleteMapping("/{id}")
       @PreAuthorize("hasRole('guanliyuan')")
       public Result<Void> deleteStudent(@PathVariable Long id) {
           xueshengxinxiService.removeById(id);
           return Result.success();
       }
   }
   ```

2. **ç»Ÿä¸€å“åº”æ ¼å¼è®¾è®¡**
   ```java
   @Data
   @AllArgsConstructor
   @NoArgsConstructor
   public class Result<T> {
       private Integer code;
       private String message;
       private T data;
       private Long timestamp;
       
       public static <T> Result<T> success() {
           return new Result<>(200, "success", null, System.currentTimeMillis());
       }
       
       public static <T> Result<T> success(T data) {
           return new Result<>(200, "success", data, System.currentTimeMillis());
       }
       
       public static <T> Result<T> success(String message, T data) {
           return new Result<>(200, message, data, System.currentTimeMillis());
       }
       
       public static <T> Result<T> error(String message) {
           return new Result<>(500, message, null, System.currentTimeMillis());
       }
       
       public static <T> Result<T> error(Integer code, String message) {
           return new Result<>(code, message, null, System.currentTimeMillis());
       }
   }
   ```

3. **APIç‰ˆæœ¬ç®¡ç†ç­–ç•¥**
   ```java
   // ç‰ˆæœ¬æ§åˆ¶æ–¹å¼1ï¼šURLè·¯å¾„ç‰ˆæœ¬æ§åˆ¶
   @RequestMapping("/api/v1/students")
   public class StudentControllerV1 {
       // v1ç‰ˆæœ¬çš„å®ç°
   }
   
   @RequestMapping("/api/v2/students")
   public class StudentControllerV2 {
       // v2ç‰ˆæœ¬çš„å®ç°
   }
   
   // ç‰ˆæœ¬æ§åˆ¶æ–¹å¼2ï¼šHeaderç‰ˆæœ¬æ§åˆ¶
   @GetMapping(value = "/students", headers = "API-VERSION=v1")
   public Result<List<Xueshengxinxi>> getStudentsV1() {
       // v1ç‰ˆæœ¬å®ç°
   }
   ```

4. **APIæ–‡æ¡£é›†æˆ**
   ```java
   @Configuration
   @EnableSwagger2
   public class SwaggerConfig {
       
       @Bean
       public Docket createRestApi() {
           return new Docket(DocumentationType.SWAGGER_2)
                   .apiInfo(apiInfo())
                   .select()
                   .apis(RequestHandlerSelectors.basePackage("com.example.controller"))
                   .paths(PathSelectors.any())
                   .build();
       }
       
       private ApiInfo apiInfo() {
           return new ApiInfoBuilder()
                   .title("å­¦ç”Ÿç®¡ç†ç³»ç»ŸAPI")
                   .description("å­¦ç”Ÿç®¡ç†ç³»ç»Ÿçš„RESTful APIæ–‡æ¡£")
                   .version("1.0.0")
                   .build();
       }
   }
   ```

## å››ã€æ•°æ®åº“è®¾è®¡ä¸ä¼˜åŒ–ç›¸å…³é—®é¢˜

### Q5: ä½ å¦‚ä½•è®¾è®¡æ•°æ®åº“è¡¨ç»“æ„ï¼Ÿå¦‚ä½•è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **æ•°æ®åº“è¡¨è®¾è®¡**
   ```sql
   -- å­¦ç”Ÿä¿¡æ¯è¡¨
   CREATE TABLE xueshengxinxi (
       id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å­¦å·',
       xingming VARCHAR(50) NOT NULL COMMENT 'å§“å',
       xingbie ENUM('ç”·', 'å¥³') NOT NULL COMMENT 'æ€§åˆ«',
       banji VARCHAR(20) NOT NULL COMMENT 'ç­çº§',
       jiguan VARCHAR(100) COMMENT 'ç±è´¯',
       dianhhua VARCHAR(20) COMMENT 'ç”µè¯',
       shenfenzheng VARCHAR(18) UNIQUE COMMENT 'èº«ä»½è¯',
       mima VARCHAR(32) NOT NULL COMMENT 'å¯†ç (MD5åŠ å¯†)',
       create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
       update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
       is_deleted TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤(0:æœªåˆ é™¤,1:å·²åˆ é™¤)',
       INDEX idx_banji (banji),
       INDEX idx_xingbie (xingbie),
       INDEX idx_xingming (xingming),
       INDEX idx_create_time (create_time)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='å­¦ç”Ÿä¿¡æ¯è¡¨';
   
   -- æ•™å¸ˆä¿¡æ¯è¡¨
   CREATE TABLE jiaoshixinxi (
       id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT 'å·¥å·',
       xingming VARCHAR(50) NOT NULL COMMENT 'å§“å',
       xingbie ENUM('ç”·', 'å¥³') NOT NULL COMMENT 'æ€§åˆ«',
       banji VARCHAR(20) COMMENT 'æ‰€å±ç­çº§',
       jiguan VARCHAR(100) COMMENT 'ç±è´¯',
       dianhhua VARCHAR(20) COMMENT 'ç”µè¯',
       shenfenzheng VARCHAR(18) UNIQUE COMMENT 'èº«ä»½è¯',
       zhicheng VARCHAR(50) COMMENT 'èŒç§°',
       zhujiao_kecheng VARCHAR(100) COMMENT 'ä¸»æ•™è¯¾ç¨‹',
       mima VARCHAR(32) NOT NULL COMMENT 'å¯†ç (MD5åŠ å¯†)',
       create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
       update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
       is_deleted TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦åˆ é™¤(0:æœªåˆ é™¤,1:å·²åˆ é™¤)',
       INDEX idx_banji (banji),
       INDEX idx_zhicheng (zhicheng),
       INDEX idx_zhujiao_kecheng (zhujiao_kecheng)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ•™å¸ˆä¿¡æ¯è¡¨';
   ```

2. **æ€§èƒ½ä¼˜åŒ–ç­–ç•¥**
   ```java
   // ç´¢å¼•ä¼˜åŒ–
   @Mapper
   public interface XueshengxinxiMapper extends BaseMapper<Xueshengxinxi> {
       
       // å¤åˆç´¢å¼•æŸ¥è¯¢ä¼˜åŒ–
       @Select("SELECT * FROM xueshengxinxi WHERE banji = #{banji} AND xingbie = #{xingbie} ORDER BY create_time DESC")
       List<Xueshengxinxi> selectByBanjiAndXingbieOptimized(@Param("banji") String banji, @Param("xingbie") String xingbie);
       
       // åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–
       @Select("SELECT * FROM xueshengxinxi WHERE create_time < #{lastId} ORDER BY create_time DESC LIMIT #{size}")
       List<Xueshengxinxi> selectByCursor(@Param("lastId") Long lastId, @Param("size") Integer size);
   }
   
   // æŸ¥è¯¢æ€§èƒ½åˆ†æ
   @Service
   public class XueshengxinxiServiceImpl implements XueshengxinxiService {
       
       @Override
       public Page<Xueshengxinxi> getOptimizedList(Integer current, Integer size, String search) {
           long startTime = System.currentTimeMillis();
           
           Page<Xueshengxinxi> page = new Page<>(current, size);
           QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
           
           // ä½¿ç”¨ç´¢å¼•å­—æ®µè¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–
           if (StringUtils.hasText(search)) {
               // é¿å…å‡½æ•°æ“ä½œï¼Œä¿æŒç´¢å¼•æœ‰æ•ˆæ€§
               wrapper.and(w -> w.like("xingming", search)
                               .or().like("banji", search)
                               .or().like("jiguan", search));
           }
           
           // åˆ©ç”¨å¤åˆç´¢å¼•
           wrapper.orderByDesc("create_time");
           
           Page<Xueshengxinxi> result = xueshengxinxiMapper.selectPage(page, wrapper);
           
           long endTime = System.currentTimeMillis();
           log.info("æŸ¥è¯¢è€—æ—¶: {}ms, è¿”å›è®°å½•æ•°: {}", endTime - startTime, result.getRecords().size());
           
           return result;
       }
   }
   ```

3. **æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–**
   ```yaml
   # application.yml
   spring:
     datasource:
       hikari:
         # è¿æ¥æ± å¤§å°
         maximum-pool-size: 20
         minimum-idle: 5
         # è¿æ¥è¶…æ—¶æ—¶é—´
         connection-timeout: 30000
         # ç©ºé—²è¿æ¥è¶…æ—¶
         idle-timeout: 300000
         # è¿æ¥æœ€å¤§ç”Ÿå­˜æ—¶é—´
         max-lifetime: 1200000
         # è¿æ¥æ³„æ¼æ£€æµ‹
         leak-detection-threshold: 60000
         # æ•°æ®åº“è¿æ¥æµ‹è¯•
         connection-test-query: SELECT 1
   ```

4. **SQLæ€§èƒ½ç›‘æ§**
   ```java
   // SQLæ€§èƒ½ç›‘æ§é…ç½®
   @Configuration
   public class MybatisConfig {
       
       @Bean
       public SqlSessionFactoryBean sqlSessionFactory(DataSource dataSource) throws Exception {
           SqlSessionFactoryBean factory = new SqlSessionFactoryBean();
           factory.setDataSource(dataSource);
           
           // å¼€å¯SQLæ—¥å¿—å’Œæ€§èƒ½åˆ†æ
           factory.setPlugins(new Interceptor[]{
               new PerformanceInterceptor(true, 1000), // è¶…è¿‡1ç§’çš„SQLè®°å½•
               new OptimisticLockerInterceptor() // ä¹è§‚é”æ’ä»¶
           });
           
           return factory;
       }
   }
   ```

## äº”ã€å®‰å…¨æ€§ç›¸å…³é—®é¢˜

### Q6: ä½ å¦‚ä½•ä¿è¯ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼Ÿæœ‰å“ªäº›å®‰å…¨æªæ–½ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **å¯†ç å®‰å…¨ç­–ç•¥**
   ```java
   @Component
   public class PasswordSecurityService {
       
       private static final String DEFAULT_PASSWORD = "e10adc3949ba59abbe56e057f20f883e"; // 123456çš„MD5
       
       public String encryptPassword(String rawPassword) {
           if (StringUtils.isEmpty(rawPassword)) {
               return DEFAULT_PASSWORD;
           }
           
           // å¢å¼ºçš„MD5åŠ å¯†ï¼ˆåŠ ç›ï¼‰
           String salt = UUID.randomUUID().toString();
           return SecureUtil.md5(rawPassword + salt) + ":" + salt;
       }
       
       public boolean verifyPassword(String rawPassword, String encryptedPassword) {
           String[] parts = encryptedPassword.split(":");
           if (parts.length != 2) {
               return false;
           }
           
           String encrypted = SecureUtil.md5(rawPassword + parts[1]);
           return encrypted.equals(parts[0]);
       }
   }
   ```

2. **JWTè®¤è¯æœºåˆ¶**
   ```java
   @Component
   public class JwtUtil {
       
       private final String SECRET_KEY = "student-management-secret-key";
       private final long EXPIRATION_TIME = 86400000; // 24å°æ—¶
       
       public String generateToken(String username) {
           Map<String, Object> claims = new HashMap<>();
           return createToken(claims, username);
       }
       
       private String createToken(Map<String, Object> claims, String subject) {
           return Jwts.builder()
                   .setClaims(claims)
                   .setSubject(subject)
                   .setIssuedAt(new Date(System.currentTimeMillis()))
                   .setExpiration(new Date(System.currentTimeMillis() + EXPIRATION_TIME))
                   .signWith(SignatureAlgorithm.HS512, SECRET_KEY)
                   .compact();
       }
       
       public String getUsernameFromToken(String token) {
           return getClaimsFromToken(token).getSubject();
       }
       
       public Date getExpirationDateFromToken(String token) {
           return getClaimsFromToken(token).getExpiration();
       }
       
       private Claims getClaimsFromToken(String token) {
           return Jwts.parser().setSigningKey(SECRET_KEY).parseClaimsJws(token).getBody();
       }
       
       public boolean validateToken(String token, UserDetails userDetails) {
           final String username = getUsernameFromToken(token);
           return (username.equals(userDetails.getUsername()) && !isTokenExpired(token));
       }
       
       private boolean isTokenExpired(String token) {
           final Date expiration = getExpirationDateFromToken(token);
           return expiration.before(new Date());
       }
   }
   ```

3. **æƒé™æ§åˆ¶å®ç°**
   ```java
   // è‡ªå®šä¹‰æƒé™æ³¨è§£
   @Target(ElementType.METHOD)
   @Retention(RetentionPolicy.RUNTIME)
   public @interface RequireRole {
       String[] value();
   }
   
   // æƒé™æ§åˆ¶åˆ‡é¢
   @Aspect
   @Component
   public class PermissionAspect {
       
       @Around("@annotation(requireRole)")
       public Object checkPermission(ProceedingJoinPoint joinPoint, RequireRole requireRole) throws Throwable {
           // è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
           Authentication authentication = SecurityContextHolder.getContext().getAuthentication();
           if (authentication == null || !authentication.isAuthenticated()) {
               throw new UnauthorizedException("ç”¨æˆ·æœªç™»å½•");
           }
           
           UserDetails userDetails = (UserDetails) authentication.getPrincipal();
           Set<String> userRoles = userDetails.getAuthorities().stream()
                   .map(GrantedAuthority::getAuthority)
                   .collect(Collectors.toSet());
           
           // æ£€æŸ¥æƒé™
           Set<String> requiredRoles = Arrays.stream(requireRole.value())
                   .collect(Collectors.toSet());
           
           if (!userRoles.containsAll(requiredRoles)) {
               throw new ForbiddenException("æƒé™ä¸è¶³");
           }
           
           return joinPoint.proceed();
       }
   }
   
   // æ§åˆ¶å™¨ä¸­çš„ä½¿ç”¨
   @RestController
   public class StudentController {
       
       @RequireRole({"guanliyuan"})
       @PostMapping
       public Result<Xueshengxinxi> addStudent(@RequestBody Xueshengxinxi student) {
           return Result.success(xueshengxinxiService.add(student));
       }
   }
   ```

4. **SQLæ³¨å…¥é˜²æŠ¤**
   ```java
   // å‚æ•°åŒ–æŸ¥è¯¢é˜²æ­¢SQLæ³¨å…¥
   @Mapper
   public interface XueshengxinxiMapper extends BaseMapper<Xueshengxinxi> {
       
       // ä½¿ç”¨MyBatis-Plusçš„QueryWrapperè‡ªåŠ¨é˜²æ­¢SQLæ³¨å…¥
       List<Xueshengxinxi> selectByCondition(@Param("condition") Map<String, Object> condition);
   }
   
   @Service
   public class XueshengxinxiServiceImpl implements XueshengxinxiService {
       
       public List<Xueshengxinxi> searchStudents(String keyword) {
           QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
           
           // å®‰å…¨çš„æ–¹å¼ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
           wrapper.like("xingming", keyword);
           wrapper.or().like("banji", keyword);
           
           return xueshengxinxiMapper.selectList(wrapper);
       }
   }
   ```

## å…­ã€äº‹åŠ¡ç®¡ç†ç›¸å…³é—®é¢˜

### Q7: ä½ å¦‚ä½•å¤„ç†äº‹åŠ¡ç®¡ç†ï¼Ÿæœ‰å“ªäº›äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **äº‹åŠ¡ç®¡ç†é…ç½®**
   ```java
   @Configuration
   @EnableTransactionManagement
   public class TransactionConfig {
       
       @Bean
       public DataSourceTransactionManager transactionManager(DataSource dataSource) {
           DataSourceTransactionManager transactionManager = new DataSourceTransactionManager();
           transactionManager.setDataSource(dataSource);
           return transactionManager;
       }
   }
   ```

2. **äº‹åŠ¡ä¼ æ’­è¡Œä¸ºåº”ç”¨**
   ```java
   @Service
   public class UserService {
       
       @Autowired
       private StudentService studentService;
       
       @Autowired
       private TeacherService teacherService;
       
       // REQUIRED: å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åŠ å…¥è¯¥äº‹åŠ¡ï¼›å¦åˆ™åˆ›å»ºæ–°äº‹åŠ¡
       @Transactional(propagation = Propagation.REQUIRED)
       public void createUser(UserCreateDTO userCreateDTO) {
           // åˆ›å»ºå­¦ç”Ÿæˆ–æ•™å¸ˆä¿¡æ¯
           if ("student".equals(userCreateDTO.getType())) {
               studentService.createStudent(userCreateDTO.getStudentInfo());
           } else if ("teacher".equals(userCreateDTO.getType())) {
               teacherService.createTeacher(userCreateDTO.getTeacherInfo());
           }
           
           // åˆ›å»ºç”¨æˆ·è´¦æˆ·
           createUserAccount(userCreateDTO.getAccountInfo());
           
           // å¦‚æœè¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œæ•´ä¸ªäº‹åŠ¡ä¼šå›æ»š
           if (shouldFail()) {
               throw new BusinessException("ç”¨æˆ·åˆ›å»ºå¤±è´¥");
           }
       }
       
       // NESTED: åœ¨å½“å‰äº‹åŠ¡ä¸­åµŒå¥—ä¸€ä¸ªæ–°äº‹åŠ¡
       @Transactional(propagation = Propagation.NESTED)
       public void createUserWithAudit(UserCreateDTO userCreateDTO) {
           // åˆ›å»ºç”¨æˆ·
           createUser(userCreateDTO);
           
           // è®°å½•å®¡è®¡æ—¥å¿—ï¼ˆåµŒå¥—äº‹åŠ¡ï¼‰
           auditService.recordCreateAction(userCreateDTO);
       }
       
       // REQUIRES_NEW: åˆ›å»ºæ–°äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡åˆ™æŒ‚èµ·
       @Transactional(propagation = Propagation.REQUIRES_NEW)
       public void recordErrorLog(String errorMessage) {
           // å³ä½¿å¤–å±‚äº‹åŠ¡å›æ»šï¼Œé”™è¯¯æ—¥å¿—ä»ç„¶ä¼šè¢«è®°å½•
           errorLogService.saveErrorLog(errorMessage);
       }
   }
   ```

3. **äº‹åŠ¡å›æ»šç­–ç•¥**
   ```java
   @Service
   public class StudentService {
       
       // é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ä¼šå¯¼è‡´å›æ»š
       @Transactional
       public Xueshengxinxi addStudent(Xueshengxinxi student) {
           // æ’å…¥å­¦ç”Ÿä¿¡æ¯
           xueshengxinxiMapper.insert(student);
           
           // æ¨¡æ‹Ÿä¸šåŠ¡æ£€æŸ¥
           if (student.getXingming() == null || student.getXingming().trim().isEmpty()) {
               throw new IllegalArgumentException("å­¦ç”Ÿå§“åä¸èƒ½ä¸ºç©º");
           }
           
           // æ£€æŸ¥é‡å¤
           if (isStudentExists(student)) {
               throw new BusinessException("å­¦ç”Ÿå·²å­˜åœ¨");
           }
           
           return student;
       }
       
       // æŒ‡å®šç‰¹å®šå¼‚å¸¸å›æ»šï¼Œå…¶ä»–å¼‚å¸¸ä¸å›æ»š
       @Transactional(rollbackFor = {BusinessException.class, DataAccessException.class})
       public void updateStudent(Xueshengxinxi student) {
           xueshengxinxiMapper.updateById(student);
       }
       
       // æ‰‹åŠ¨æ§åˆ¶äº‹åŠ¡å›æ»š
       @Transactional
       public void processStudentData(Xueshengxinxi student) {
           try {
               // ä¸šåŠ¡å¤„ç†
               processBasicInfo(student);
               processContactInfo(student);
               processAcademicInfo(student);
           } catch (Exception e) {
               // æ‰‹åŠ¨å›æ»šäº‹åŠ¡
               TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();
               throw new BusinessException("æ•°æ®å¤„ç†å¤±è´¥", e);
           }
       }
   }
   ```

## ä¸ƒã€å¼‚å¸¸å¤„ç†ç›¸å…³é—®é¢˜

### Q8: ä½ å¦‚ä½•è®¾è®¡å…¨å±€å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **å…¨å±€å¼‚å¸¸å¤„ç†å™¨**
   ```java
   @ControllerAdvice
   public class GlobalExceptionHandler {
       
       private static final Logger logger = LoggerFactory.getLogger(GlobalExceptionHandler.class);
       
       // å¤„ç†ä¸šåŠ¡å¼‚å¸¸
       @ExceptionHandler(BusinessException.class)
       public Result<String> handleBusinessException(BusinessException e, HttpServletRequest request) {
           logger.warn("ä¸šåŠ¡å¼‚å¸¸: {}, è¯·æ±‚è·¯å¾„: {}", e.getMessage(), request.getRequestURI());
           return Result.error(e.getCode(), e.getMessage());
       }
       
       // å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸
       @ExceptionHandler(MethodArgumentNotValidException.class)
       public Result<String> handleValidationException(MethodArgumentNotValidException e) {
           String errorMessage = e.getBindingResult().getFieldError().getDefaultMessage();
           logger.warn("å‚æ•°æ ¡éªŒå¼‚å¸¸: {}", errorMessage);
           return Result.error(400, "å‚æ•°æ ¡éªŒå¤±è´¥: " + errorMessage);
       }
       
       // å¤„ç†æ•°æ®è®¿é—®å¼‚å¸¸
       @ExceptionHandler(DataAccessException.class)
       public Result<String> handleDataAccessException(DataAccessException e, HttpServletRequest request) {
           logger.error("æ•°æ®åº“è®¿é—®å¼‚å¸¸: {}, è¯·æ±‚è·¯å¾„: {}", e.getMessage(), request.getRequestURI(), e);
           return Result.error(500, "æ•°æ®åº“æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•");
       }
       
       // å¤„ç†æœªæˆæƒå¼‚å¸¸
       @ExceptionHandler({UnauthorizedException.class, org.springframework.security.access.AccessDeniedException.class})
       public Result<String> handleUnauthorizedException(Exception e) {
           logger.warn("æœªæˆæƒè®¿é—®: {}", e.getMessage());
           return Result.error(401, "æœªæˆæƒè®¿é—®ï¼Œè¯·å…ˆç™»å½•");
       }
       
       // å¤„ç†ç¦æ­¢è®¿é—®å¼‚å¸¸
       @ExceptionHandler(ForbiddenException.class)
       public Result<String> handleForbiddenException(ForbiddenException e) {
           logger.warn("æƒé™ä¸è¶³: {}", e.getMessage());
           return Result.error(403, "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®è¯¥èµ„æº");
       }
       
       // å¤„ç†èµ„æºæœªæ‰¾åˆ°å¼‚å¸¸
       @ExceptionHandler(ResourceNotFoundException.class)
       public Result<String> handleResourceNotFoundException(ResourceNotFoundException e) {
           logger.warn("èµ„æºæœªæ‰¾åˆ°: {}", e.getMessage());
           return Result.error(404, "è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨");
       }
       
       // å¤„ç†ç³»ç»Ÿå¼‚å¸¸
       @ExceptionHandler(Exception.class)
       public Result<String> handleException(Exception e, HttpServletRequest request) {
           logger.error("ç³»ç»Ÿå¼‚å¸¸: {}, è¯·æ±‚è·¯å¾„: {}", e.getMessage(), request.getRequestURI(), e);
           return Result.error(500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
       }
       
       // å¤„ç†ç©ºæŒ‡é’ˆå¼‚å¸¸
       @ExceptionHandler(NullPointerException.class)
       public Result<String> handleNullPointerException(NullPointerException e, HttpServletRequest request) {
           logger.error("ç©ºæŒ‡é’ˆå¼‚å¸¸: {}, è¯·æ±‚è·¯å¾„: {}", e.getMessage(), request.getRequestURI(), e);
           return Result.error(500, "ç³»ç»Ÿé”™è¯¯ï¼Œè¯·è”ç³»ç®¡ç†å‘˜");
       }
   }
   ```

2. **è‡ªå®šä¹‰å¼‚å¸¸ä½“ç³»**
   ```java
   // åŸºç¡€å¼‚å¸¸ç±»
   public abstract class BaseException extends RuntimeException {
       protected Integer code;
       
       public BaseException(String message) {
           super(message);
       }
       
       public BaseException(Integer code, String message) {
           super(message);
           this.code = code;
       }
       
       public Integer getCode() {
           return code;
       }
   }
   
   // ä¸šåŠ¡å¼‚å¸¸
   public class BusinessException extends BaseException {
       public BusinessException(String message) {
           super(500, message);
       }
       
       public BusinessException(Integer code, String message) {
           super(code, message);
       }
       
       public BusinessException(String message, Throwable cause) {
           super(500, message);
           initCause(cause);
       }
   }
   
   // æƒé™å¼‚å¸¸
   public class UnauthorizedException extends BaseException {
       public UnauthorizedException(String message) {
           super(401, message);
       }
   }
   
   public class ForbiddenException extends BaseException {
       public ForbiddenException(String message) {
           super(403, message);
       }
   }
   
   // èµ„æºæœªæ‰¾åˆ°å¼‚å¸¸
   public class ResourceNotFoundException extends BaseException {
       public ResourceNotFoundException(String message) {
           super(404, message);
       }
   }
   ```

3. **å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ**
   ```java
   @Service
   public class StudentService {
       
       public Xueshengxinxi getStudentById(Long id) {
           if (id == null || id <= 0) {
               throw new IllegalArgumentException("å­¦ç”ŸIDå¿…é¡»ä¸ºæ­£æ•°");
           }
           
           Xueshengxinxi student = xueshengxinxiMapper.selectById(id);
           if (student == null) {
               throw new ResourceNotFoundException("å­¦ç”Ÿä¸å­˜åœ¨: ID=" + id);
           }
           
           return student;
       }
       
       @Transactional
       public Xueshengxinxi updateStudent(Long id, Xueshengxinxi studentInfo) {
           try {
               // éªŒè¯å­¦ç”Ÿæ˜¯å¦å­˜åœ¨
               Xueshengxinxi existingStudent = getStudentById(id);
               
               // ä¸šåŠ¡é€»è¾‘æ£€æŸ¥
               if (!existingStudent.getBanji().equals(studentInfo.getBanji())) {
                   // æ£€æŸ¥æ–°ç­çº§æ˜¯å¦å­˜åœ¨
                   if (!classService.isClassExists(studentInfo.getBanji())) {
                       throw new BusinessException("ç­çº§ä¸å­˜åœ¨: " + studentInfo.getBanji());
                   }
               }
               
               // æ›´æ–°å­¦ç”Ÿä¿¡æ¯
               studentInfo.setId(id);
               studentInfo.setUpdateTime(LocalDateTime.now());
               xueshengxinxiMapper.updateById(studentInfo);
               
               return studentInfo;
               
           } catch (DataAccessException e) {
               logger.error("æ›´æ–°å­¦ç”Ÿä¿¡æ¯æ—¶æ•°æ®åº“å¼‚å¸¸", e);
               throw new BusinessException("æ›´æ–°å­¦ç”Ÿä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•", e);
           }
       }
   }
   ```

## å…«ã€ç¼“å­˜ç­–ç•¥ç›¸å…³é—®é¢˜

### Q9: ä½ å¦‚ä½•å®ç°ç¼“å­˜ç­–ç•¥ï¼Ÿæœ‰å“ªäº›ç¼“å­˜æ–¹æ¡ˆï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **Spring CacheæŠ½è±¡å±‚**
   ```java
   @Configuration
   @EnableCaching
   public class CacheConfig {
       
       @Bean
       public CacheManager cacheManager() {
           CaffeineCacheManager cacheManager = new CaffeineCacheManager();
           cacheManager.setCaffeine(Caffeine.newBuilder()
                   .initialCapacity(100)
                   .maximumSize(1000)
                   .expireAfterWrite(Duration.ofMinutes(30))
                   .recordStats());
           return cacheManager;
       }
   }
   ```

2. **æ³¨è§£å¼ç¼“å­˜åº”ç”¨**
   ```java
   @Service
   public class XueshengxinxiService {
       
       // ç¼“å­˜å­¦ç”Ÿåˆ—è¡¨ï¼Œæ¯5åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
       @Cacheable(value = "students", key = "#current + '-' + #size + '-' + #search", condition = "#search != null")
       public Page<Xueshengxinxi> getStudentList(Integer current, Integer size, String search) {
           Page<Xueshengxinxi> page = new Page<>(current, size);
           QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
           
           if (StringUtils.hasText(search)) {
               wrapper.like("xingming", search)
                     .or().like("banji", search);
           }
           
           return xueshengxinxiMapper.selectPage(page, wrapper);
       }
       
       // ç¼“å­˜å•ä¸ªå­¦ç”Ÿä¿¡æ¯ï¼Œ30åˆ†é’Ÿè¿‡æœŸ
       @Cacheable(value = "student", key = "#id", condition = "#id != null")
       public Xueshengxinxi getStudentById(Long id) {
           return xueshengxinxiMapper.selectById(id);
       }
       
       // æ›´æ–°å­¦ç”Ÿä¿¡æ¯æ—¶æ¸…é™¤ç¼“å­˜
       @CacheEvict(value = "student", key = "#student.id")
       public Xueshengxinxi updateStudent(Xueshengxinxi student) {
           xueshengxinxiMapper.updateById(student);
           return student;
       }
       
       // æ·»åŠ å­¦ç”Ÿæ—¶æ¸…é™¤æ•´ä¸ªå­¦ç”Ÿåˆ—è¡¨ç¼“å­˜
       @CacheEvict(value = "students", allEntries = true)
       public Xueshengxinxi addStudent(Xueshengxinxi student) {
           xueshengxinxiMapper.insert(student);
           return student;
       }
       
       // æ‰¹é‡æ¸…é™¤ç¼“å­˜
       @Caching(evict = {
           @CacheEvict(value = "student", key = "#id"),
           @CacheEvict(value = "students", allEntries = true)
       })
       public void deleteStudent(Long id) {
           xueshengxinxiMapper.deleteById(id);
       }
   }
   ```

3. **æ‰‹åŠ¨ç¼“å­˜æ“ä½œ**
   ```java
   @Service
   public class StudentStatisticsService {
       
       @Autowired
       private CacheManager cacheManager;
       
       // æ‰‹åŠ¨ç¼“å­˜æ“ä½œ
       public List<StudentStatistics> getStatisticsByClass(String banji) {
           Cache cache = cacheManager.getCache("statistics");
           String cacheKey = "stats_" + banji;
           
           // å…ˆä»ç¼“å­˜è·å–
           List<StudentStatistics> stats = cache.get(cacheKey, List.class);
           if (stats != null) {
               logger.info("ä»ç¼“å­˜è·å–ç­çº§ç»Ÿè®¡ä¿¡æ¯: {}", banji);
               return stats;
           }
           
           // ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œä»æ•°æ®åº“æŸ¥è¯¢
           stats = calculateStatistics(banji);
           
           // å­˜å…¥ç¼“å­˜
           cache.put(cacheKey, stats);
           logger.info("æŸ¥è¯¢æ•°æ®åº“å¹¶ç¼“å­˜ç­çº§ç»Ÿè®¡ä¿¡æ¯: {}", banji);
           
           return stats;
       }
       
       // ç¼“å­˜é¢„çƒ­
       @PostConstruct
       public void warmUpCache() {
           logger.info("å¼€å§‹ç¼“å­˜é¢„çƒ­...");
           
           // é¢„çƒ­ç­çº§åˆ—è¡¨
           List<String> classList = getAllClasses();
           for (String banji : classList) {
               getStatisticsByClass(banji);
           }
           
           logger.info("ç¼“å­˜é¢„çƒ­å®Œæˆ");
       }
       
       // ç¼“å­˜æ¸…ç†
       @Scheduled(fixedRate = 3600000) // æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡
       public void clearExpiredCache() {
           Cache cache = cacheManager.getCache("statistics");
           if (cache != null) {
               // æ¸…ç†è¿‡æœŸç¼“å­˜
               cache.clear();
               logger.info("æ¸…ç†è¿‡æœŸç»Ÿè®¡ç¼“å­˜");
           }
       }
   }
   ```

4. **åˆ†å¸ƒå¼ç¼“å­˜é›†æˆ**
   ```java
   @Configuration
   public class RedisConfig {
       
       @Bean
       public RedisTemplate<String, Object> redisTemplate(RedisConnectionFactory connectionFactory) {
           RedisTemplate<String, Object> template = new RedisTemplate<>();
           template.setConnectionFactory(connectionFactory);
           
           // ä½¿ç”¨StringRedisSerializeråºåˆ—åŒ–key
           template.setKeySerializer(new StringRedisSerializer());
           template.setHashKeySerializer(new StringRedisSerializer());
           
           // ä½¿ç”¨Jackson2JsonRedisSerializeråºåˆ—åŒ–value
           template.setValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));
           template.setHashValueSerializer(new Jackson2JsonRedisSerializer<>(Object.class));
           
           template.afterPropertiesSet();
           return template;
       }
   }
   
   @Service
   public class DistributedCacheService {
       
       @Autowired
       private RedisTemplate<String, Object> redisTemplate;
       
       // åˆ†å¸ƒå¼ç¼“å­˜å­¦ç”Ÿæ•°æ®
       @Cacheable(value = "distributed:students", key = "#id", cacheManager = "redisCacheManager")
       public Xueshengxinxi getStudentWithDistributedCache(Long id) {
           logger.info("ä»æ•°æ®åº“æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯: {}", id);
           return xueshengxinxiMapper.selectById(id);
       }
       
       // ä½¿ç”¨Rediså®ç°åˆ†å¸ƒå¼é”
       public boolean executeWithLock(String lockKey, Runnable task) {
           String lockValue = UUID.randomUUID().toString();
           
           // å°è¯•è·å–é”
           Boolean acquired = redisTemplate.opsForValue()
                   .setIfAbsent(lockKey, lockValue, Duration.ofSeconds(30));
           
           if (acquired) {
               try {
                   task.run();
                   return true;
               } finally {
                   // é‡Šæ”¾é”
                   String script = 
                       "if redis.call('get', KEYS[1]) == ARGV[1] then " +
                       "return redis.call('del', KEYS[1]) " +
                       "else return 0 end";
                   
                   redisTemplate.execute(new DefaultRedisScript<>(script, Long.class), 
                                       Collections.singletonList(lockKey), lockValue);
               }
           }
           
           return false;
       }
   }
   ```

## ä¹ã€æ€§èƒ½ç›‘æ§ç›¸å…³é—®é¢˜

### Q10: ä½ å¦‚ä½•è¿›è¡Œæ€§èƒ½ç›‘æ§å’Œè°ƒä¼˜ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **Spring Boot Actuatorç›‘æ§**
   ```java
   # application.yml
   management:
     endpoints:
       web:
         exposure:
           include: health,info,metrics,prometheus,loggers
       endpoint:
         health:
           show-details: always
     metrics:
       export:
         prometheus:
           enabled: true
     info:
       git:
         mode: full
   ```

2. **è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡**
   ```java
   @Component
   public class StudentMetrics {
       
       private final MeterRegistry meterRegistry;
       private final Counter studentCreateCounter;
       private final Timer studentQueryTimer;
       private final Gauge activeStudentsGauge;
       
       public StudentMetrics(MeterRegistry meterRegistry) {
           this.meterRegistry = meterRegistry;
           
           // åˆ›å»ºè®¡æ•°å™¨ - ç»Ÿè®¡å­¦ç”Ÿåˆ›å»ºæ•°é‡
           this.studentCreateCounter = Counter.builder("student.created.total")
                   .description("Total number of students created")
                   .register(meterRegistry);
           
           // åˆ›å»ºè®¡æ—¶å™¨ - ç»Ÿè®¡æŸ¥è¯¢è€—æ—¶
           this.studentQueryTimer = Timer.builder("student.query.duration")
                   .description("Time taken to query students")
                   .register(meterRegistry);
           
           // åˆ›å»ºä»ªè¡¨ - ç›‘æ§æ´»è·ƒå­¦ç”Ÿæ•°é‡
           this.activeStudentsGauge = Gauge.builder("student.active.count")
                   .description("Number of active students")
                   .register(meterRegistry, this, StudentMetrics::getActiveStudentCount);
       }
       
       public void recordStudentCreation() {
           studentCreateCounter.increment();
       }
       
       public <T> T recordQueryTime(Supplier<T> queryOperation) {
           return studentQueryTimer.record(queryOperation);
       }
       
       private int getActiveStudentCount() {
           // è·å–å½“å‰æ´»è·ƒå­¦ç”Ÿæ•°é‡
           return studentService.getActiveStudentCount();
       }
   }
   
   @Service
   public class XueshengxinxiService {
       
       @Autowired
       private StudentMetrics studentMetrics;
       
       public Xueshengxinxi addStudent(Xueshengxinxi student) {
           Xueshengxinxi result = studentMetrics.recordQueryTime(() -> {
               Xueshengxinxi created = xueshengxinxiMapper.insert(student);
               studentMetrics.recordStudentCreation();
               return created;
           });
           
           return result;
       }
       
       public List<Xueshengxinxi> getActiveStudents() {
           return studentMetrics.recordQueryTime(() -> {
               QueryWrapper<Xueshengxinxi> wrapper = new QueryWrapper<>();
               wrapper.eq("is_active", 1);
               return xueshengxinxiMapper.selectList(wrapper);
           });
       }
   }
   ```

3. **æ•°æ®åº“æ€§èƒ½ç›‘æ§**
   ```java
   @Configuration
   public class DatabaseMonitoringConfig {
       
       @Bean
       public DataSource dataSource(DataSourceProperties properties) {
           HikariDataSource dataSource = properties.initializeDataSourceBuilder()
                   .type(HikariDataSource.class)
                   .build();
           
           // æ·»åŠ ç›‘æ§
           dataSource.setMetricRegistry(meterRegistry);
           
           return dataSource;
       }
   }
   
   @Service
   public class PerformanceMonitoringService {
       
       private static final Logger logger = LoggerFactory.getLogger(PerformanceMonitoringService.class);
       
       @EventListener
       public void handleSlowQuery(SlowQueryEvent event) {
           if (event.getDuration() > 1000) { // è¶…è¿‡1ç§’çš„æŸ¥è¯¢
               logger.warn("æ…¢æŸ¥è¯¢æ£€æµ‹: SQL={}, è€—æ—¶={}ms, å‚æ•°={}", 
                         event.getSql(), event.getDuration(), event.getParameters());
               
               // å‘é€å‘Šè­¦
               alertService.sendSlowQueryAlert(event);
           }
       }
       
       @Scheduled(fixedRate = 60000) // æ¯åˆ†é’Ÿæ‰§è¡Œ
       public void monitorDatabasePerformance() {
           // ç›‘æ§è¿æ¥æ± çŠ¶æ€
           HikariDataSource dataSource = (HikariDataSource) this.dataSource;
           
           int activeConnections = dataSource.getHikariPoolMXBean().getActiveConnections();
           int totalConnections = dataSource.getHikariPoolMXBean().getTotalConnections();
           
           logger.info("æ•°æ®åº“è¿æ¥æ± çŠ¶æ€: æ´»è·ƒè¿æ¥={}, æ€»è¿æ¥={}", 
                     activeConnections, totalConnections);
           
           // è¿æ¥æ•°è¿‡é«˜å‘Šè­¦
           if (activeConnections > totalConnections * 0.8) {
               alertService.sendConnectionPoolAlert(activeConnections, totalConnections);
           }
       }
   }
   ```

4. **åº”ç”¨æ€§èƒ½è°ƒä¼˜**
   ```java
   @Configuration
   public class PerformanceOptimizationConfig {
       
       // å¼‚æ­¥å¤„ç†é…ç½®
       @Bean
       public TaskExecutor taskExecutor() {
           ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
           executor.setCorePoolSize(5);
           executor.setMaxPoolSize(20);
           executor.setQueueCapacity(100);
           executor.setThreadNamePrefix("StudentAsync-");
           executor.initialize();
           return executor;
       }
   }
   
   @Service
   public class AsyncStudentService {
       
       @Autowired
       private TaskExecutor taskExecutor;
       
       @Async
       public CompletableFuture<Void> sendWelcomeEmailAsync(Long studentId) {
           try {
               // å‘é€æ¬¢è¿é‚®ä»¶çš„å¼‚æ­¥å¤„ç†
               Student student = studentService.getStudentById(studentId);
               emailService.sendWelcomeEmail(student);
               return CompletableFuture.completedFuture(null);
           } catch (Exception e) {
               logger.error("å‘é€æ¬¢è¿é‚®ä»¶å¤±è´¥", e);
               return CompletableFuture.failedFuture(e);
           }
       }
       
       // æ‰¹é‡å¤„ç†ä¼˜åŒ–
       @Transactional
       public void batchProcessStudents(List<Long> studentIds) {
           // åˆ†æ‰¹å¤„ç†ï¼Œæ¯æ‰¹100ä¸ª
           List<List<Long>> batches = Lists.partition(studentIds, 100);
           
           for (List<Long> batch : batches) {
               taskExecutor.execute(() -> {
                   processStudentBatch(batch);
               });
           }
       }
       
       private void processStudentBatch(List<Long> studentIds) {
           for (Long studentId : studentIds) {
               try {
                   // æ‰¹é‡å¤„ç†é€»è¾‘
                   processStudent(studentId);
               } catch (Exception e) {
                   logger.error("å¤„ç†å­¦ç”Ÿä¿¡æ¯å¤±è´¥: {}", studentId, e);
               }
           }
       }
   }
   ```

## åã€å¾®æœåŠ¡ä¸æ‰©å±•æ€§ç›¸å…³é—®é¢˜

### Q11: ä½ çš„ç³»ç»Ÿå¦‚ä½•æ”¯æŒæ‰©å±•ï¼Ÿæœ‰å“ªäº›æ‰©å±•ç­–ç•¥ï¼Ÿ

**å‚è€ƒç­”æ¡ˆï¼š**

1. **å¾®æœåŠ¡æ¶æ„è®¾è®¡**
   ```java
   // ç”¨æˆ·æœåŠ¡
   @SpringBootApplication
   @EnableDiscoveryClient
   public class UserServiceApplication {
       public static void main(String[] args) {
           SpringApplication.run(UserServiceApplication.class, args);
       }
   }
   
   @RestController
   @RequestMapping("/api/v1/users")
   public class UserController {
       
       @Autowired
       private UserService userService;
       
       @GetMapping("/{id}")
       public Result<User> getUser(@PathVariable Long id) {
           return Result.success(userService.getUserById(id));
       }
       
       @PostMapping
       public Result<User> createUser(@RequestBody User user) {
           return Result.success(userService.createUser(user));
       }
   }
   ```

2. **æœåŠ¡å‘ç°ä¸æ³¨å†Œ**
   ```yaml
   # application.yml
   spring:
     application:
       name: student-management-user-service
     cloud:
       nacos:
         discovery:
           server-addr: localhost:8848
           namespace: student-management
   ```

3. **APIç½‘å…³é…ç½®**
   ```java
   @Configuration
   @EnableZuulProxy
   public class ZuulConfig {
       
       @Bean
       public ZuulFilter routeFilter() {
           return new ZuulFilter() {
               @Override
               public String filterType() {
                   return "route";
               }
               
               @Override
               public int filterOrder() {
                   return 0;
               }
               
               @Override
               public boolean shouldFilter() {
                   return true;
               }
               
               @Override
               public Object run() {
                   RequestContext context = RequestContext.getCurrentContext();
                   HttpServletRequest request = context.getRequest();
                   
                   // æ·»åŠ è¯·æ±‚æ—¥å¿—
                   logger.info("è·¯ç”±è¯·æ±‚: {} {}", request.getMethod(), request.getRequestURL().toString());
                   
                   return null;
               }
           };
       }
   }
   ```

4. **é…ç½®ä¸­å¿ƒç®¡ç†**
   ```java
   @Configuration
   @RefreshScope
   public class DatabaseConfig {
       
       @Value("${student.database.max-connections:20}")
       private int maxConnections;
       
       @Value("${student.database.timeout:30000}")
       private int timeout;
       
       public int getMaxConnections() {
           return maxConnections;
       }
       
       public int getTimeout() {
           return timeout;
       }
   }
   ```

## å›ç­”æŠ€å·§ä¸æ³¨æ„äº‹é¡¹

### ğŸ’¡ **å›ç­”ç­–ç•¥**ï¼š
1. **æŠ€æœ¯æ·±åº¦**ï¼šå±•ç¤ºå¯¹Spring Bootç”Ÿæ€çš„æ·±å…¥ç†è§£
2. **å®é™…åº”ç”¨**ï¼šç»“åˆé¡¹ç›®å…·ä½“å®ç°è¯´æ˜æŠ€æœ¯åº”ç”¨
3. **æ€§èƒ½æ„è¯†**ï¼šçªå‡ºæ€§èƒ½ä¼˜åŒ–çš„å…·ä½“æªæ–½
4. **æ¶æ„æ€ç»´**ï¼šå±•ç¤ºç³»ç»Ÿæ¶æ„å’Œæ‰©å±•æ€§è®¾è®¡

### ğŸ¯ **é‡ç‚¹å±•ç¤º**ï¼š
- **Spring Bootè‡ªåŠ¨é…ç½®**æœºåˆ¶çš„ç†è§£å’Œåº”ç”¨
- **MyBatis-Plus**çš„CRUDæ“ä½œå’Œæ€§èƒ½ä¼˜åŒ–
- **RESTful API**è®¾è®¡çš„æœ€ä½³å®è·µ
- **æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–**çš„å…·ä½“æªæ–½
- **å®‰å…¨æœºåˆ¶**çš„å®Œæ•´å®ç°

### ğŸ“Š **é‡åŒ–æˆæœ**ï¼š
- **APIå“åº”æ—¶é—´**ï¼š<500ms
- **æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–**ï¼š10å€æ€§èƒ½æå‡
- **ç¼“å­˜å‘½ä¸­ç‡**ï¼š>90%
- **ç³»ç»Ÿå¯ç”¨æ€§**ï¼š99.9%

### ğŸ”§ **æŠ€æœ¯äº®ç‚¹**ï¼š
- Spring Bootè‡ªåŠ¨é…ç½®çš„æ·±åº¦ç†è§£
- MyBatis-Plusçš„æ¡ä»¶æ„é€ å™¨ä½¿ç”¨
- åˆ†å¸ƒå¼ç¼“å­˜ä¸æœ¬åœ°ç¼“å­˜ç»“åˆ
- å®Œæ•´çš„å¼‚å¸¸å¤„ç†ä½“ç³»
- å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡æ€æƒ³

è¿™ä»½é¢„æ¡ˆæ¶µç›–äº†åç«¯å¼€å‘çš„å„ä¸ªé‡è¦æ–¹é¢ï¼Œæ‚¨å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´å’Œè¡¥å……ï¼Œç¡®ä¿èƒ½å¤Ÿå……åˆ†å±•ç¤ºæ‚¨çš„åç«¯å¼€å‘èƒ½åŠ›å’Œé¡¹ç›®æˆæœã€‚